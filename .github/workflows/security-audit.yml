name: Security Audit

on:
  schedule:
    - cron: '0 9 * * 1'  # Her Pazartesi saat 09:00
  pull_request:
    branches: [main, master]
  workflow_dispatch:  # Manuel Ã§alÄ±ÅŸtÄ±rma

jobs:
  frontend-audit:
    name: Frontend GÃ¼venlik KontrolÃ¼
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Node.js Kurulumu
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        run: npm ci
      
      - name: GÃ¼venlik TaramasÄ±
        run: npm audit --audit-level=moderate --json > frontend-audit.json || true
      
      - name: Rapor OluÅŸtur
        run: |
          echo "## ğŸ”’ Frontend GÃ¼venlik Raporu" >> $GITHUB_STEP_SUMMARY
          npm audit --audit-level=moderate || echo "âœ… GÃ¼venlik aÃ§Ä±ÄŸÄ± bulunamadÄ±" >> $GITHUB_STEP_SUMMARY

  backend-audit:
    name: Backend GÃ¼venlik KontrolÃ¼
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Node.js Kurulumu
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: functions/package-lock.json
      
      - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        working-directory: ./functions
        run: npm ci
      
      - name: GÃ¼venlik TaramasÄ±
        working-directory: ./functions
        run: npm audit --audit-level=moderate --json > backend-audit.json || true
      
      - name: Rapor OluÅŸtur
        working-directory: ./functions
        run: |
          echo "## ğŸ”’ Backend GÃ¼venlik Raporu" >> $GITHUB_STEP_SUMMARY
          npm audit --audit-level=moderate || echo "âœ… GÃ¼venlik aÃ§Ä±ÄŸÄ± bulunamadÄ±" >> $GITHUB_STEP_SUMMARY

  notify:
    name: Bildirim
    runs-on: ubuntu-latest
    needs: [frontend-audit, backend-audit]
    if: always()
    steps:
      - name: Durum KontrolÃ¼
        run: |
          echo "âœ… GÃ¼venlik taramasÄ± tamamlandÄ±"
          echo "ğŸ“Š DetaylÄ± rapor iÃ§in Actions sekmesini kontrol edin"
